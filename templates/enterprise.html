<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Enterprise Safety Hub - TrustEngine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        /* Modal forensic loader */
        .forensic-loader {
            display: grid;
            place-items: center;
            position: absolute;
            inset: 0;
            background: rgba(11,15,25,0.6);
            z-index: 40;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-8">

    <div class="flex justify-between items-end mb-8">
        <div>
            <div class="flex items-center gap-3 mb-2">
                <a href="/" class="text-sm text-slate-500 hover:text-emerald-600 font-medium">
                    <i class="fa-solid fa-shield-halved mr-1"></i> TrustEngine
                </a>
                <span class="text-slate-300">/</span>
                <span class="text-sm text-slate-900 font-semibold">Enterprise Hub</span>
            </div>
            <h1 class="text-2xl font-bold text-slate-900">Global Threat Intelligence</h1>
            <p class="text-slate-500 text-sm">Real-time forensic monitoring across connected assets.</p>
        </div>
        <div class="flex items-center gap-4">
            <button onclick="fetchData()" class="p-2 text-slate-400 hover:text-emerald-600 transition-colors">
                <i class="fa-solid fa-rotate"></i>
            </button>
            <span class="flex items-center gap-2 px-3 py-1 bg-emerald-50 text-emerald-700 rounded-full text-xs font-bold border border-emerald-100 shadow-sm">
                <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                LIVE MONITORING
            </span>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
            <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-2">Total Assets Scanned</div>
            <div class="text-3xl font-bold text-slate-800" id="stat-total">--</div>
            <div class="text-emerald-500 text-xs font-bold mt-2 flex items-center gap-1">
                <i class="fa-solid fa-arrow-trend-up"></i> 12% vs last week
            </div>
        </div>
        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
            <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-2">AI Manipulated</div>
            <div class="text-3xl font-bold text-slate-800" id="stat-ai">--</div>
            <div class="text-red-500 text-xs font-bold mt-2 flex items-center gap-1">
                <i class="fa-solid fa-triangle-exclamation"></i> High Risk
            </div>
        </div>
        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
            <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-2">Clean Assets</div>
            <div class="text-3xl font-bold text-slate-800" id="stat-clean">--</div>
            <div class="text-slate-400 text-xs mt-2">Verified Authentic</div>
        </div>
        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
            <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-2">Avg. Confidence</div>
            <div class="text-3xl font-bold text-slate-800">98.4%</div>
            <div class="text-orange-500 text-xs font-bold mt-2">Model Accuracy</div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col">
            <div class="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                <h3 class="font-bold text-slate-800 flex items-center gap-2">
                    <i class="fa-solid fa-list-ul text-slate-400"></i> Detection Log
                </h3>
            </div>

            <div class="overflow-y-auto flex-grow max-h-[500px]">
                <table class="w-full text-left text-sm">
                    <thead class="bg-slate-50 text-slate-500 border-b border-slate-100 sticky top-0 z-10">
                        <tr>
                            <th class="px-6 py-3 font-medium text-xs uppercase tracking-wider">Asset / User</th>
                            <th class="px-6 py-3 font-medium text-xs uppercase tracking-wider">Detection Type</th>
                            <th class="px-6 py-3 font-medium text-xs uppercase tracking-wider">Probability</th>
                            <th class="px-6 py-3 font-medium text-xs uppercase tracking-wider">Timestamp</th>
                            <th class="px-6 py-3 font-medium text-xs uppercase tracking-wider text-right">Action</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100" id="violations-table">
                        <tr class="animate-pulse">
                            <td colspan="5" class="px-6 py-4 text-center text-slate-400">Loading live stream...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="space-y-6">
            <div class="bg-slate-900 rounded-2xl p-6 text-white flex flex-col relative overflow-hidden h-80 shadow-lg">
                <div class="absolute top-0 right-0 w-64 h-64 bg-emerald-500 rounded-full blur-[100px] opacity-10 pointer-events-none"></div>
                <h3 class="font-bold text-sm mb-4 relative z-10 uppercase tracking-wider text-slate-400">Threat Origins</h3>
                <div class="flex-1 bg-slate-800/50 rounded-xl mb-4 relative flex items-center justify-center border border-slate-700/50 overflow-hidden group">
                    <div class="absolute inset-0 opacity-20 bg-[url('https://upload.wikimedia.org/wikipedia/commons/e/ec/World_map_blank_without_borders.svg')] bg-cover bg-center bg-no-repeat transition-transform duration-[10s] group-hover:scale-110"></div>
                    <div class="absolute top-1/3 left-1/4 w-3 h-3 bg-red-500 rounded-full shadow-[0_0_15px_rgba(239,68,68,0.8)] animate-ping"></div>
                    <div class="absolute bottom-1/3 right-1/4 w-2 h-2 bg-orange-500 rounded-full shadow-[0_0_15px_rgba(249,115,22,0.8)] animate-ping delay-75"></div>
                    <div class="relative z-10 text-center">
                        <div class="text-3xl font-mono font-bold text-white">42</div>
                        <div class="text-xs text-slate-400">Active Nodes</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div id="reportModal" class="fixed inset-0 z-50 hidden transition-opacity duration-300 opacity-0">
        <div class="absolute inset-0 bg-slate-900/90 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-slate-50 w-full max-w-6xl h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden transform scale-95 transition-transform duration-300" id="modal-panel">
                <div class="bg-white border-b border-slate-200 p-4 flex justify-between items-center z-20">
                    <div>
                        <div class="flex items-center gap-2">
                            <h2 class="text-xl font-bold text-slate-900">Technical Analysis Report</h2>
                            <span class="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs font-mono border border-slate-200" id="modal-id">ID: pst_001</span>
                        </div>
                        <p class="text-xs text-slate-500 mt-1 font-mono" id="modal-timestamp">--</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600">
                            <i class="fa-solid fa-xmark text-xl"></i>
                        </button>
                    </div>
                </div>

                <div class="flex-1 overflow-hidden grid grid-cols-12 bg-slate-50">
                    <div class="col-span-8 bg-[#0B0F19] relative flex flex-col justify-center items-center p-8 overflow-hidden">
                        <div class="relative max-h-[70%] max-w-full shadow-2xl rounded border border-slate-700 bg-black">
                            <!-- image container -->
                            <img id="modal-image" src="" class="block h-full w-full object-contain transition-all duration-300" alt="report image">
                            <!-- loader while forensic images are created -->
                            <div id="forensic-loader" class="forensic-loader hidden">
                                <div class="text-white text-center">
                                    <div class="mb-3"><i class="fa-solid fa-spinner fa-spin fa-2x"></i></div>
                                    <div class="font-mono">Running forensic filters...</div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 flex gap-2 bg-slate-800/80 p-1.5 rounded-lg border border-slate-700 backdrop-blur z-20">
                            <button onclick="setFilter('original')" id="btn-original" class="px-4 py-1.5 text-xs font-bold text-slate-900 bg-white rounded shadow-sm transition-all">ORIGINAL</button>
                            <button onclick="setFilter('ela')" id="btn-ela" class="px-4 py-1.5 text-xs font-medium text-slate-400 hover:text-white transition-all">ELA</button>
                            <button onclick="setFilter('noise')" id="btn-noise" class="px-4 py-1.5 text-xs font-medium text-slate-400 hover:text-white transition-all">NOISE</button>
                            <button onclick="setFilter('heatmap')" id="btn-heatmap" class="px-4 py-1.5 text-xs font-medium text-slate-400 hover:text-white transition-all">HEATMAP</button>
                        </div>
                    </div>

                    <div class="col-span-4 bg-white border-l border-slate-200 p-6 overflow-y-auto space-y-6">
                        <div class="bg-white rounded-xl border border-slate-100 shadow-sm p-5">
                            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Detection Verdict</div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-4xl font-bold text-slate-900" id="modal-score">--%</div>
                                    <div class="text-sm text-slate-500">Probability of AI Origin</div>
                                </div>
                                <div class="relative w-16 h-16">
                                    <svg class="w-full h-full" viewBox="0 0 36 36">
                                        <path class="text-slate-100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3" />
                                        <path id="score-ring" class="text-emerald-500 transition-all duration-1000 ease-out" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3" />
                                    </svg>
                                    <i id="verdict-icon" class="fa-solid fa-check absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-emerald-500"></i>
                                </div>
                            </div>

                            <div class="mt-6 space-y-3">
                                <div class="flex justify-between text-sm border-b border-slate-50 pb-2">
                                    <span class="text-slate-500">Risk Level</span>
                                    <span class="font-bold px-2 py-0.5 rounded text-xs" id="modal-risk">--</span>
                                </div>
                                <div class="flex justify-between text-sm pt-1">
                                    <span class="text-slate-500">Flags Raised</span>
                                    <span class="font-bold text-red-500" id="modal-flags">-- Issues</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl border border-slate-100 shadow-sm p-5">
                            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-microscope"></i> Forensic Findings
                            </div>
                            <ul class="space-y-3 text-sm text-slate-600" id="modal-findings"></ul>
                        </div>

                        <div class="bg-slate-50 rounded-xl border border-slate-200 p-4">
                            <div class="text-xs font-bold text-slate-500 mb-2">Noise Distribution Analysis</div>
                            <div class="h-24 flex items-end justify-between gap-1 px-2" id="noise-bars"></div>
                            <div class="text-right text-[10px] text-red-500 font-bold mt-1 opacity-0" id="noise-warning">Abnormal Spike Detected</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

<script>
/* ---------- Forensic image handling (real backend filters) ---------- */
/*
Assumes backend endpoint:
POST /api/forensic-filters
FormData: { image: FILE }
Returns JSON:
{ original: "/static/uploads/name.jpg", ela: "/static/uploads/name_ela.jpg", noise: "...", heatmap: "..." }
*/

let forensicImages = null; // cache for current modal open
let forensicLoading = false;

// loads forensic images from backend for a given image path (URL)
async function loadForensics(imgPath) {
    try {
        forensicLoading = true;
        setForensicLoader(true);

        // fetch the image as blob and send to backend as file
        const response = await fetch(imgPath);
        if (!response.ok) throw new Error('Failed to fetch source image: ' + response.status);

        const blob = await response.blob();

        const formData = new FormData();
        // name it so backend secure_filename works
        formData.append('image', blob, 'report_image.jpg');

        const res = await fetch('/api/forensic-filters', {
            method: 'POST',
            body: formData
        });

        if (!res.ok) {
            const text = await res.text();
            throw new Error('Forensic API error: ' + (text || res.status));
        }

        const json = await res.json();

        // Minimal validation
        if (!json || (!json.original && !json.ela && !json.noise && !json.heatmap)) {
            throw new Error('Invalid response from forensic API');
        }

        forensicImages = json;
        forensicLoading = false;
        setForensicLoader(false);
        return forensicImages;
    } catch (err) {
        forensicLoading = false;
        setForensicLoader(false);
        console.error('loadForensics error:', err);
        alert('Forensic analysis failed: ' + err.message);
        return null;
    }
}

function setForensicLoader(on) {
    const loader = document.getElementById('forensic-loader');
    if (!loader) return;
    if (on) loader.classList.remove('hidden');
    else loader.classList.add('hidden');
}

// apply the chosen filter by swapping image src to backend-produced URLs
async function setFilter(type) {
    const img = document.getElementById('modal-image');
    const overlay = document.getElementById('heatmap-overlay'); // we keep overlay element but won't use CSS heatmap
    const buttons = ['original', 'ela', 'noise', 'heatmap'];

    // disable buttons while loading
    buttons.forEach(t => {
        const b = document.getElementById('btn-' + t);
        if (b) b.disabled = true;
    });

    try {
        if (!forensicImages) {
            // start loading forensic images
            const curSrc = img.getAttribute('data-src') || img.src;
            const loaded = await loadForensics(curSrc);
            if (!loaded) {
                // fallback to original if loading failed
                forensicImages = null;
            }
        }

        // choose best available path
        if (!forensicImages) {
            // fallback behaviour: do not change src if no forensic images
            // enable buttons and return
            updateButtons(type, false);
            return;
        }

        let target = forensicImages.original || (img.getAttribute('data-src') || img.src);
        if (type === 'ela' && forensicImages.ela) target = forensicImages.ela;
        if (type === 'noise' && forensicImages.noise) target = forensicImages.noise;
        if (type === 'heatmap' && forensicImages.heatmap) target = forensicImages.heatmap;

        // swap src
        img.src = target;
        updateButtons(type, true);
    } catch (err) {
        console.error('setFilter error:', err);
        alert('Failed to apply forensic filter: ' + err.message);
    } finally {
        // re-enable buttons
        ['original','ela','noise','heatmap'].forEach(t => {
            const b = document.getElementById('btn-' + t);
            if (b) b.disabled = false;
        });
    }
}

// update button styles; `hasForensic` toggles whether we show as active or disabled look
function updateButtons(active, hasForensic) {
    ['original','ela','noise','heatmap'].forEach(t => {
        const btn = document.getElementById('btn-' + t);
        if (!btn) return;
        if (t === active) {
            btn.className = "px-4 py-1.5 text-xs font-bold text-slate-900 bg-white rounded shadow-sm transition-all";
        } else {
            btn.className = hasForensic
                ? "px-4 py-1.5 text-xs font-medium text-slate-400 hover:text-white transition-all"
                : "px-4 py-1.5 text-xs font-medium text-slate-300 cursor-not-allowed";
        }
    });
}

/* ---------- Data / modal flow ---------- */

async function fetchData() {
    try {
        const response = await fetch('/api/enterprise/dashboard-data');
        const data = await response.json();

        // Stats
        document.getElementById('stat-total').innerText = data.stats.total_assets;
        document.getElementById('stat-ai').innerText = data.stats.ai_detected;
        document.getElementById('stat-clean').innerText = data.stats.clean;

        // Table
        const tbody = document.getElementById('violations-table');
        tbody.innerHTML = '';

        data.recent_violations.forEach(v => {
            const tr = document.createElement('tr');
            tr.className = "hover:bg-slate-50 border-b border-slate-50 transition-colors";

            const isHighRisk = v.ai_generated;
            const confidence = isHighRisk ? "98.2%" : "12.5%";
            const confidenceColor = isHighRisk ? "text-red-600" : "text-emerald-600";
            const detectionType = isHighRisk ? `<i class="fa-solid fa-robot text-purple-500 mr-2"></i>GenAI / Synthetic` : `<i class="fa-regular fa-image text-slate-400 mr-2"></i>Organic Media`;

            // Note: JSON.stringify used to pass object into onclick; ensure v does not contain functions
            tr.innerHTML = `
                <td class="px-6 py-4">
                    <div class="flex items-center gap-3">
                        <img src="/${v.image_path}" class="w-10 h-10 rounded object-cover border border-slate-200">
                        <div class="font-medium text-slate-700">${escapeHtml(v.user_name)}</div>
                    </div>
                </td>
                <td class="px-6 py-4 text-slate-600">${detectionType}</td>
                <td class="px-6 py-4 font-mono font-bold ${confidenceColor}">${confidence}</td>
                <td class="px-6 py-4 text-slate-500 font-mono text-xs">${escapeHtml(v.date)}</td>
                <td class="px-6 py-4 text-right">
                    <button class="text-indigo-600 hover:text-indigo-800 font-medium text-xs border border-indigo-200 hover:border-indigo-400 px-3 py-1.5 rounded-lg transition-all"
                            onclick='openReport(${JSON.stringify(v)})'>
                        View Report
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
        });

    } catch (error) {
        console.error("Error fetching data:", error);
        const tbody = document.getElementById('violations-table');
        tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-4 text-center text-red-500">Failed to load data</td></tr>`;
    }
}

// helper to avoid HTML injection in table text
function escapeHtml(unsafe) {
    if (unsafe === null || unsafe === undefined) return '';
    return String(unsafe)
        .replaceAll('&', "&amp;")
        .replaceAll('<', "&lt;")
        .replaceAll('>', "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
}

function openReport(data) {
    const modal = document.getElementById('reportModal');
    const panel = document.getElementById('modal-panel');
    const img = document.getElementById('modal-image');
    const score = document.getElementById('modal-score');
    const ring = document.getElementById('score-ring');
    const risk = document.getElementById('modal-risk');
    const findings = document.getElementById('modal-findings');
    const noiseBars = document.getElementById('noise-bars');
    const noiseWarn = document.getElementById('noise-warning');

    // Reset forensic cache so each open creates fresh forensic images
    forensicImages = null;

    // Set placeholder while backend processes
    setForensicLoader(false);

    // Populate data fields
    // Ensure image path begins with slash
    const imgPath = data.image_path.startsWith('/') ? data.image_path : ('/' + data.image_path);
    img.setAttribute('data-src', imgPath); // original URL for backend fetch
    img.src = imgPath;

    document.getElementById('modal-timestamp').innerText = new Date().toLocaleString();
    document.getElementById('modal-id').innerText = `ID: ${escapeHtml(data.id || 'pst_001')}`;

    // Build noise bars (visualization only)
    let barsHtml = '';
    for (let i = 0; i < 15; i++) {
        let h = Math.floor(Math.random() * 60) + 20;
        let color = "bg-indigo-200";
        if (data.ai_generated && i === 10) { h = 90; color = "bg-red-500 animate-pulse"; }
        barsHtml += `<div class="w-1.5 rounded-t ${color}" style="height: ${h}%"></div>`;
    }
    noiseBars.innerHTML = barsHtml;

    // Fill findings & verdict simple placeholders; we'll update after forensic images return
    if (data.ai_generated) {
        score.innerText = "98.2%";
        score.className = "text-4xl font-bold text-red-600";
        setTimeout(() => ring.setAttribute("stroke-dasharray", "98, 100"), 300);
        ring.setAttribute("class", "text-red-500 transition-all duration-1000 ease-out");
        risk.innerText = "CRITICAL";
        risk.className = "px-2 py-0.5 rounded text-xs bg-red-50 text-red-600 border border-red-100 font-bold";
        document.getElementById('modal-flags').innerText = "2 Issues Found";
        noiseWarn.classList.remove('opacity-0');
        findings.innerHTML = `
            <li class="flex gap-2 text-red-600 font-medium">
                <i class="fa-solid fa-circle-xmark mt-1"></i>
                <span>Synthetic skin texture detected (Frequency mismatch).</span>
            </li>
            <li class="flex gap-2 text-red-600 font-medium">
                <i class="fa-solid fa-circle-xmark mt-1"></i>
                <span>Background warping indicates Generative Fill usage.</span>
            </li>
        `;
    } else {
        score.innerText = "12.5%";
        score.className = "text-4xl font-bold text-emerald-600";
        setTimeout(() => ring.setAttribute("stroke-dasharray", "12, 100"), 300);
        ring.setAttribute("class", "text-emerald-500 transition-all duration-1000 ease-out");
        risk.innerText = "LOW";
        risk.className = "px-2 py-0.5 rounded text-xs bg-emerald-50 text-emerald-600 border border-emerald-100 font-bold";
        document.getElementById('modal-flags').innerText = "0 Issues";
        noiseWarn.classList.add('opacity-0');
        findings.innerHTML = `
            <li class="flex gap-2">
                <i class="fa-solid fa-check text-emerald-500 mt-1"></i>
                <span>Noise distribution consistent with camera sensor.</span>
            </li>
            <li class="flex gap-2">
                <i class="fa-solid fa-check text-emerald-500 mt-1"></i>
                <span>No GAN-specific artifacts found in quick scan.</span>
            </li>
        `;
    }

    // Show modal
    modal.classList.remove('hidden');
    setTimeout(() => {
        modal.classList.remove('opacity-0');
        panel.classList.remove('scale-95');
        panel.classList.add('scale-100');
    }, 50);

    // Immediately start loading forensic images (they will replace the displayed image when ready)
    // Keep UI responsive: show loader overlay
    (async () => {
        setForensicLoader(true);
        const f = await loadForensics(imgPath);
        if (f) {
            // once we have forensics, automatically display original processed image
            // show original processed image if backend returned a processed original, else keep current
            if (f.original) {
                document.getElementById('modal-image').src = f.original;
            }
            // update findings from backend if present (optional keys)
            if (f.findings && Array.isArray(f.findings)) {
                const el = document.getElementById('modal-findings');
                el.innerHTML = f.findings.map(fn => `<li class="flex gap-2">${escapeHtml(fn)}</li>`).join('');
            }
            // If backend returned a score override, use it
            if (typeof f.ai_probability !== 'undefined') {
                const p = Math.round(Number(f.ai_probability));
                document.getElementById('modal-score').innerText = (isFinite(p) ? p + '%' : document.getElementById('modal-score').innerText);
                document.getElementById('modal-score').className = p > 70 ? "text-4xl font-bold text-red-600" : "text-4xl font-bold text-emerald-600";
                setTimeout(() => {
                    document.getElementById('score-ring').setAttribute("stroke-dasharray", `${p}, 100`);
                }, 200);
            }

            // default to ORIGINAL processed image
            setFilter('original');
        } else {
            // if forensic failed, simply allow user to view original and disable forensic options visually
            updateButtons('original', false);
        }
        setForensicLoader(false);
    })();
}

function closeModal() {
    const modal = document.getElementById('reportModal');
    const panel = document.getElementById('modal-panel');

    modal.classList.add('opacity-0');
    panel.classList.remove('scale-100');
    panel.classList.add('scale-95');

    setTimeout(() => {
        modal.classList.add('hidden');
    }, 300);
}

// init
fetchData();
</script>
</body>
</html>
